{% extends 'base.html' %}
{% block title %}Patients{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Patients</h2>
</div>

<form method="get" class="mb-3">
  <div class="form-row align-items-end">
    <div class="col-md-6">
      <label for="q">Rechercher un patient</label>
      <input type="text" id="q" name="q" value="{{ q|default:'' }}" class="form-control" placeholder="DN, nom, prénom ou date (JJ/MM/AAAA ou AAAA-MM-JJ)">
    </div>
    <div class="col-md-3">
      <button type="submit" class="btn btn-outline-primary">Rechercher</button>
      <a href="{% url 'patients_list' %}" class="btn btn-link">Réinitialiser</a>
    </div>
  </div>
</form>

<table class="table table-striped table-sm">
  <thead class="thead-light">
    <tr>
      <th>DN</th>
      <th>Nom</th>
      <th>Prénom</th>
      <th>Date de naissance</th>
  <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for p in patients %}
      <tr>
        <td>{{ p.dn }}</td>
        <td>{{ p.nom }}</td>
        <td>{{ p.prenom }}</td>
        <td>{% if p.date_naissance %}{{ p.date_naissance|date:'d/m/Y' }}{% endif %}</td>
        <td>
          <a class="btn btn-sm btn-outline-dark" href="{% url 'patients_detail' p.dn %}">Fiche</a>
          <a class="btn btn-sm btn-outline-danger" href="{% url 'patient_delete' p.dn %}">Supprimer</a>
        </td>
      </tr>
    {% empty %}
      <tr><td colspan="5" class="text-center">Aucun patient trouvé.</td></tr>
    {% endfor %}
  </tbody>
</table>

{% if is_paginated %}
<nav aria-label="Pagination patients" class="d-flex justify-content-center">
  <ul class="pagination">
    {% if page_obj.number > 1 %}
      <li class="page-item">
        <a class="page-link" href="?page=1{% if q %}&q={{ q|urlencode }}{% endif %}">Première</a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Première</span></li>
    {% endif %}

    {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}">Précédent</a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Précédent</span></li>
    {% endif %}

    <li class="page-item disabled"><span class="page-link">Page {{ page_obj.number }} / {{ paginator.num_pages }}</span></li>

    {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}">Suivant</a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Suivant</span></li>
    {% endif %}

    {% if page_obj.number < paginator.num_pages %}
      <li class="page-item">
        <a class="page-link" href="?page={{ paginator.num_pages }}{% if q %}&q={{ q|urlencode }}{% endif %}">Dernière</a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Dernière</span></li>
    {% endif %}
  </ul>
</nav>
{% endif %}

 
{% endblock %}
